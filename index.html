<!doctype html>
<html class="no-js" lang="">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>Ekans js!</title>
		<meta name="description" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		<!-- Place favicon.ico and apple-touch-icon(s) in the root directory -->

		<link rel="stylesheet" href="assets/css/normalize.css">
		<link rel="stylesheet" href="assets/css/main.css">
		<link rel="stylesheet" href="assets/css/app.css">
	</head>
	<body>

		<div class="intro">
			<div class="intro-wrap">
				<h1>EKANS JS</h1>
				<p>snake game created with javascript!</p>
				<p>press SPACE BAR to start</p>
				<p>or click on the big button above</p>
			</div>
		</div>

		<div class="game-wrap">
			<table class="game" cellspacing="0" id="game">
			</table>
			<div class="game-buttons">
				<div class="buttons-wrap">
					<div class="buttons-directionals-wrap">
						<a class="buttons buttons-directionals is-up" href="javascript:void(0);"></a>
						<a class="buttons buttons-directionals is-right" href="javascript:void(0);"></a>
						<a class="buttons buttons-directionals is-down" href="javascript:void(0);"></a>
						<a class="buttons buttons-directionals is-left" href="javascript:void(0);"></a>
					</div>

					<div class="buttons-start-wrap">
						<a class="buttons buttons-start" href="javascript:void(0);"></a>
					</div>
				</div>
			</div>
		</div>

		<script type="text/template" id="field-template">
			<td class="game-field <% if (snake) { %> is-snake <% } %> <% if (food) { %> is-food <% } %>"
				data-position="<%= position %>"
				data-line="<%= line %>">
			</td>
		</script>

		<script src="./bower_components/jquery/dist/jquery.min.js"></script>
		<script src="./bower_components/underscore/underscore.js"></script>

		<script src="/lib/helpers.js"></script>
		<script src="/lib/data/food.js"></script>
		<script src="/lib/data/field.js"></script>
		<script src="/lib/data/snake.js"></script>
		<script src="/lib/views/fieldView.js"></script>
		<script src="/lib/ekans.js"></script>

		<script>
			(function () {
				var ekans = (function () {
					var app, attributes= {
						keys: {
							space: 32
						},
						messages: {
							newGame: 'Do you really want to start a new game?'
						},

						running: false
					},

					app = {
						initialize: function () {
							this.set();
							this.hideSnake();
							this.bind();
							this.showIntro();
						},

						set: function () {
							this.ekans = new Ekans();
							this.$items = $('td');
							this.$intro = $('.intro');
							this.$body = $('body');
						},

						bind: function () {
							this.$body.on('keypress', this.onKey);
						},

						hideSnake: function () {
							this.$items.removeClass('is-snake is-food');
						},

						hideIntro: function () {
							this.$intro.removeClass('is-visible');
						},

						showIntro: function () {
							this.$intro.addClass('is-visible');
						},

						onKey: function (event) {
							switch (event.which) {
								case attributes.keys.space :
									event.preventDefault();
									if (!attributes.running) {
										app.start();
									}
									else if (confirm(attributes.messages.newGame)) {
										app.start();
									}
								break;
							}
							
						},

						start: function () {
							if (attributes.running) {
								this.ekans.end();
							}

							attributes.running = true;
							app.hideIntro();
							this.ekans = new Ekans();
							app.ekans.start();
						}

					};

					return app;

				}().initialize());
			}());
		</script>

	</body>
</html>
